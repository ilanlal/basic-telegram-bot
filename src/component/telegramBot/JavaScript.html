<script>
    (function () {
        this.Global_Resources = {
            "module": "bot-setup",
            "version": "0.0.1",
            "en": {
                "welcome": "Welcome to telegram bot",
                "bot": {
                    "name": "Bot name",
                    "shortDescription": "Short description",
                    "description": "Description",
                    "commands": "Commands"
                },
                "actions": {
                    "action": "Action",
                    "message": "Message",
                    "method": "Method",
                    "payload": {
                        "payload": "Payload",
                        "caption": "Caption",
                        "text": "Text",
                        "photo": "Photo",
                        "video": "Video",
                        "reply": "Reply",
                        "reply_markup": "Reply markup",
                        "keyboard": "Keyboard",
                        "inline_keyboard": "Inline keyboard",
                        "callback_data": "Callback data",
                        "url": "URL",
                        "callback_query": "Callback query",
                        "chat_id": "Chat ID",
                        "message_id": "Message ID",
                        "parse_mode": "Parse mode",
                        "disable_web_page_preview": "Disable web page preview",
                        "disable_notification": "Disable notification",
                        "reply_to_message_id": "Reply to message ID"
                    }
                },
            }
        };

        const locale = 'en';
        const resources = this.Global_Resources[locale];

        const _botSetup = this.BotSetup = {
            // Model class
            AppHandler: {
                // start method
                start: (appDOM) => {
                    console.log('ðŸ˜€ start', appDOM);
                    const viewModel = _botSetup.ViewModel;
                    viewModel.start();
                },
                
            },
            // View class
            ViewModel: {
                WELCOME_CARD_ID: 'welcome-card',
                HELP_CARD_ID: 'help-card',
                // start method
                start: () => {
                    console.log('ðŸ˜€ ViewModel.start');
                    _botSetup.CardView.renderPage({ container: document.getElementById("app") });
                },
                // onClick method
                onClick: (e) => {
                    console.log('ðŸ˜€ onClick', e);
                    const viewModel = _botSetup.ViewModel;
                    if (e.target.id === 'refresh') {
                        // refresh the page
                    }
                },
            },
            // CardView class
            CardView: {
                // renderSidebar method
                renderPage: ({ container = document.getElementById("app") }) => {
                    console.log('ðŸ˜€ renderPage', { container });
                    if (!container) {
                        return;
                    }

                    // Add container
                    container.innerHTML = '<div class="container" id="appContainer"></div>';

                    _botSetup.CardView.appendCard({
                        container: container.querySelector('#appContainer'),
                        key: _botSetup.ViewModel.WELCOME_CARD_ID,
                        title: '<h1>ver: ' + this.Global_Resources.version + '</h1>'
                    });

                    _botSetup.CardView.appendCard({
                        container: container.querySelector('#appContainer'),
                        key: _botSetup.ViewModel.HELP_CARD_ID,
                        title: resources.welcome,
                        content: "<form id='form'><input type='text' name='name' placeholder='Name' required><input type='submit' value='Submit'></form>",
                        actions: [{
                            id: 'refresh',
                            label: 'Refresh',
                            handler: 'BotSetup.ViewModel.onClick(event)'
                        }]
                    });

                },
                appendCard: ({ container, key, title, subtitle, content, actions, hidden }) => {
                    console.log('ðŸ˜€ renderCard', { container, key, title, subtitle, content, actions });
                    if (!container) {
                        return;
                    }

                    let html = '';
                    // Card
                    html += `<div class="card ${hidden ? 'hidden' : ''}" id="${key}">`;
                    // Add card titlex
                    html += `  <div class="title">${title}`;
                    html += '    <div class="right led"></div>';
                    if (subtitle) {
                        html += `    <div class="subtitle1">${subtitle}</div>`;
                    }
                    html += '  </div>';
                    // Add card content
                    html += '  <div class="content body1">';
                    html += content || '';
                    html += '  </div>';
                    if (actions) {
                        // Add card actions
                        html += '  <div class="action">';
                        actions.forEach((action) => {
                            html += `    <input class="button ${action.className || 'primary'}" type="button" value="${action.label}"`
                                + ` id="${action.id}" `
                                + ` onclick="${action.handler}" />`;
                        });
                        html += '  </div>';
                    }

                    // end of card
                    html += '</div>';
                    container.innerHTML += html;
                }
            }
        };

        _botSetup.AppHandler.start();
    })();


</script>